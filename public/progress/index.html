<!doctype html>
<html lang="ru">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <meta charset="utf-8" />
  <title>Прогресс учеников</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #111827;
      --accent: #38bdf8;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --star: #facc15;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
	  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
	  background: radial-gradient(circle at top left, #1b263b 0%, #0d1b2a 45%, #0b141f 100%);
	  color: #e0e7ff;
	  min-height: 100vh;
	  display: flex;
	  flex-direction: column;
	  align-items: stretch;
	  background-attachment: fixed;
    }

    header {
	  padding: 16px 20px;
	  border-bottom: 1px solid #1f2937;
	  display: flex;
	  flex-direction: column; /* <- вертикально */
	  justify-content: center;
	  align-items: center;    /* <- горизонтально центр */
	  gap: 4px;
	  text-align: center;
    }

    header h1 {
	  font-family: "Press Start 2P", monospace;
	  letter-spacing: 1px;
	  text-shadow: 0 0 8px rgba(125, 245, 255, 0.5);
      font-size: 2rem;
      font-weight: 600;
	  text-align: center;
	  width: 100%;
	  margin-bottom: 6px;
    }


    header span {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    main {
      padding: 16px 20px 32px;
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
    }

    #status {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }

    .card {
	  background: rgba(17, 24, 39, 0.75);
	  border-radius: 14px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.08);
	  backdrop-filter: blur(4px);
	  box-shadow: 0 6px 20px rgba(0,0,0,0.4),
		  0 0 10px rgba(125, 245, 255, 0.04);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
	
	.card:hover {
	  transform: translateY(-3px);
	  border-color: rgba(125, 245, 255, 0.85);
	  box-shadow: 0 10px 25px rgba(0,0,0,0.5),
				  0 0 16px rgba(125, 245, 255, 0.55);
	}

	.avatar-wrap {
	  position: relative;
	  width: 90px;
	  height: 90px;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	}

	/* ссылка вокруг аватарки */
	.avatar-link {
	  display: block;
	  width: 56px;
	  height: 56px;
	  border-radius: 50%;
	}

	/* круглый аватар (и для div, и для img) */
	.avatar {
	  width: 56px;
	  height: 56px;
	  border-radius: 50%;
	  overflow: hidden;
	  background: radial-gradient(circle at 30% 20%, #38bdf8, #0ea5e9);
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  font-weight: 700;
	  color: #0f172a;
	  font-size: 1rem;
	  text-transform: uppercase;
	}

	.avatar-wrap img.avatar {
	  width: 100%;
	  height: 100%;
	  object-fit: cover;
	}
	
    .stars-ring {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .star {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 12px;
      color: var(--star);
      text-shadow: 0 0 6px rgba(250, 204, 21, 0.8);
    }

    .name {
      font-size: 0.95rem;
      font-weight: 600;
      text-align: center;
    }

    .meta {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-align: center;
    }

    .meta strong {
      color: var(--accent);
      font-weight: 600;
    }

    .empty {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 8px;
    }

    @media (max-width: 600px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      main {
        padding: 12px 12px 24px;
      }
    }
	
	.leaders {
	  margin-bottom: 24px;
	  text-align: center;
	}

	.leaders h2 {
	  font-size: 1rem;
	  font-weight: 600;
	  margin: 0 0 25px;
	}

	.podium {
	  display: flex;
	  justify-content: center;
	  gap: 12px;
	  align-items: flex-end;
	  flex-wrap: wrap;
	}

	/* карточки лидеров используют тот же .card, но с модификацией */
	.podium .card {
	  min-width: 150px;
	  max-width: 180px;
	  position: relative;
	}

	/* подиум: серебро слева чуть ниже, золото по центру выше, бронза справа чуть ниже */
	.podium .card.gold {
	  border: 2px solid #facc15;
	  box-shadow: 0 0 10px #facc15aa;
	  transform: translateY(-10px) scale(1.05);
	}
	.podium .card.silver {
	  border: 2px solid #e5e7eb;
	  box-shadow: 0 0 10px #e5e7eb88;
	  transform: translateY(0px);
	}
	.podium .card.bronze {
	  border: 2px solid #f97316;
	  box-shadow: 0 0 10px #f59e0b66;
	  transform: translateY(2px);
	}

	/* маленький бейджик "1 место" */
	.place-badge {
	  position: absolute;
	  top: 6px;
	  right: 8px;
	  padding: 2px 6px;
	  border-radius: 999px;
	  font-size: 0.65rem;
	  font-weight: 600;
	  background: rgba(15,23,42,0.9);
	  border: 1px solid rgba(148,163,184,0.7);
	}

	/* ПОИСК */
	.search-wrap {
	  margin: 10px 0 14px;
	}

	#searchInput {
	  width: 100%;
	  max-width: 320px;
	  padding: 10px 14px;
	  border-radius: 8px;
	  border: 2px solid rgba(125, 245, 255, 0.4);
	  background: rgba(10, 20, 35, 0.8);
	  color: #cfe8ff;
	  font-size: 0.9rem;
	  outline: none;
	  box-shadow: 0 0 8px rgba(125, 245, 255, 0.2);
	  text-align: center;
	}
	#searchInput::placeholder {
	  color: #6b7280;
	}
	#searchInput:focus {
	  border-color: #7df5ff;
	  box-shadow: 0 0 12px rgba(125, 245, 255, 0.4);
	}
	
	.podium .name {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  line-height: 1.2;
	}

	.podium .name div:first-child {
	  font-size: 1rem;
	  font-weight: 700;
	}

	.podium .name div:last-child {
	  font-size: 0.9rem;
	  font-weight: 500;
	  opacity: 0.9;
	}
	

	
	.leaders {
	  text-align: center;
	}

	.leaders h2 {
	  width: 100%;
	  text-align: center;
	}
	.search-wrap {
	  display: flex;
	  justify-content: center;
	  margin: 8px 0 20px;
	}
	#status {
	  padding-bottom: 20px;
	}
	
  </style>
</head>
<body>
  <header>
    <div>
      <h1 style="text-align:center; width:100%;">Прогресс участников курса</h1>
      <span>AI COURSE WEBSITES & GAMES</span>
    </div>
    
  </header>

  <main>
    <!-- ЛИДЕРЫ -->
    <section class="leaders">
  	<h2>ТОП-3</h2>
  	<div id="podium" class="podium"></div>
    </section>
  
    <!-- ПОИСК -->
    <div class="search-wrap">
  	<input
  	  id="searchInput"
  	  type="search"
  	  placeholder="Найти себя по фамилии или имени…"
  	  aria-label="Поиск ученика по имени"
  	/>
    </div>
  
    <!-- ОСНОВНАЯ СЕТКА -->
    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none;">
  	Пока нет ни одной записи или ничего не найдено по запросу. Попробуйте поменять текст поиска.
    </div>
	
	<div id="status" style="text-align:center; margin-top:30px; color:#9ca3af;">
	  Загружаю данные…
	</div>
  </main>



<script>
  // === НАСТРОЙКИ ===
  const CSV_PATH = "https://docs.google.com/spreadsheets/d/1JJfgxFl6FczKSOeSQHRk20A-iQk83buj1fgbgPbRiVU/export?format=csv&gid=613453476";   // если CSV в той же папке, оставь так
  const MAX_STARS = 12;              // максимум звёзд вокруг аватарки
  const TASKS_PER_STAR = 1;          // 1 звезда = 1 задание (можно поменять)

  const statusEl = document.getElementById("status");
  const gridEl = document.getElementById("grid");
  const emptyEl = document.getElementById("empty");
  const podiumEl = document.getElementById("podium");
  const searchInput = document.getElementById("searchInput");

  let allStudents = [];

  // ====== ЗАГРУЗКА CSV ======
  async function loadCSV() {
    try {
      statusEl.textContent = "Загружаю данные из CSV…";
      const res = await fetch(CSV_PATH); // анти-кеш
      if (!res.ok) {
        throw new Error("Не получилось загрузить CSV: " + res.status);
      }

      const text = await res.text();
	  console.log(text);
      const students = parseCSV(text);
      allStudents = students;

      if (students.length === 0) {
        statusEl.textContent = "Записей пока нет.";
      } else {
        statusEl.textContent = "Загружено участников: " + students.length;
      }

      renderAll();
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Ошибка загрузки данных. Проверь файл students.csv и его формат.";
      gridEl.innerHTML = "";
      if (podiumEl) podiumEl.innerHTML = "";
      emptyEl.style.display = "block";
    }
  }

  // ====== ПАРСЕР CSV ======
  // ожидаем заголовки: name,completed,(опционально) avatar,profile
  function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/);
    if (lines.length <= 1) return [];

    const header = lines[0].split(",").map(h => h.trim().toLowerCase());

    const idxName      = header.indexOf("name");
    const idxCompleted = header.indexOf("completed");
    const idxAvatar    = header.indexOf("avatar");
    const idxProfile   = header.indexOf("profile");

    if (idxName === -1 || idxCompleted === -1) {
      console.warn("В CSV должны быть колонки name и completed");
      return [];
    }

    const students = [];

    for (let i = 1; i < lines.length; i++) {
      const line = lines[i].trim();
      if (!line) continue;

      const parts = line.split(",");

      const name = (parts[idxName] || "").trim();
      const completedRaw = (parts[idxCompleted] || "").trim();
      const avatar = idxAvatar !== -1 ? (parts[idxAvatar] || "").trim() : "";
      const profile = idxProfile !== -1 ? (parts[idxProfile] || "").trim() : "";

      if (!name) continue;

      const completed = Number.parseInt(completedRaw, 10) || 0;
      students.push({ name, completed, avatar, profile });
    }

    return students;
  }

  // ====== ГЛАВНЫЙ РЕНДЕР (топ-3 + список) ======
	function renderAll(filterText = "") {
	  const q = filterText.trim().toLowerCase();

	  // 1) ПОДИУМ ВСЕГДА СЧИТАЕМ ПО ВСЕМ ДАННЫМ (allStudents)
	  if (!allStudents || allStudents.length === 0) {
		renderPodium([]);
	  } else {
		const sortedByScoreAll = allStudents
		  .slice()
		  .sort((a, b) => {
			if (b.completed !== a.completed) return b.completed - a.completed;
			return a.name.localeCompare(b.name, "ru");
		  });
		const top3All = sortedByScoreAll.slice(0, 3);
		renderPodium(top3All);
	  }

	  // 2) СПИСОК НИЖЕ — ТОЛЬКО ДЛЯ ФИЛЬТРАЦИИ / ПОИСКА
	  let filtered = allStudents.slice();

	  if (q) {
		filtered = filtered.filter(st =>
		  st.name.toLowerCase().includes(q)
		);
	  }

	  if (filtered.length === 0) {
		gridEl.innerHTML = "";
		emptyEl.style.display = "block";
		return;
	  } else {
		emptyEl.style.display = "none";
	  }

	  // 3) ДЛЯ СПИСКА: сортируем по алфавиту
	  const listSorted = filtered.slice().sort((a, b) =>
		a.name.localeCompare(b.name, "ru")
	  );

	  renderGrid(listSorted);
	}


  // ====== ПОДИУМ (топ-3) ======
  function renderPodium(top3) {
    if (!podiumEl) return;
    podiumEl.innerHTML = "";

    if (!top3 || top3.length === 0) {
      const msg = document.createElement("div");
      msg.className = "meta";
      msg.textContent = "Пока недостаточно данных для отображения лидеров.";
      podiumEl.appendChild(msg);
      return;
    }

    // слева — 2 место, центр — 1 место, справа — 3 место
    const positions = [
      { index: 1, className: "silver", place: 2 },
      { index: 0, className: "gold",   place: 1 },
      { index: 2, className: "bronze", place: 3 }
    ];

    positions.forEach(pos => {
      const st = top3[pos.index];
      if (!st) return;

      const card = createStudentCard(st);
      card.classList.add(pos.className);

      const badge = document.createElement("div");
      badge.className = "place-badge";
      badge.textContent = pos.place + " место";
      card.appendChild(badge);

      podiumEl.appendChild(card);
    });
  }

  // ====== СЕТКА ДЛЯ ОСТАЛЬНЫХ ======
  function renderGrid(students) {
    gridEl.innerHTML = "";
    students.forEach(st => {
      const card = createStudentCard(st);
      gridEl.appendChild(card);
    });
  }

  // ====== СОЗДАНИЕ КАРТОЧКИ УЧЕНИКА (общий конструктор) ======
  function createStudentCard(st) {
    const card = document.createElement("article");
    card.className = "card";

    const wrap = document.createElement("div");
    wrap.className = "avatar-wrap";

    const avatarEl = createAvatarElement(st);

    const starsRing = document.createElement("div");
    starsRing.className = "stars-ring";

    const starCount = Math.min(
      Math.max(0, Math.floor(st.completed / TASKS_PER_STAR)),
      MAX_STARS
    );
    placeStars(starsRing, st.completed);

    wrap.appendChild(avatarEl);
    wrap.appendChild(starsRing);

	const nameEl = document.createElement("div");
	nameEl.className = "name";

	// Разделяем имя и фамилию
	const parts = st.name.split(" ").filter(Boolean);
	const firstName = parts[0] || "";
	const lastName = parts.slice(1).join(" ") || "";

	// Формируем 2 строки
	nameEl.innerHTML = `
	  <div>${firstName}</div>
	  <div>${lastName}</div>
	`;

    const metaEl = document.createElement("div");
    metaEl.className = "meta";
    metaEl.innerHTML = `Выполнено заданий: <strong>${st.completed}</strong>`;

    card.appendChild(wrap);
    card.appendChild(nameEl);
    card.appendChild(metaEl);

    return card;
  }

  // ====== АВАТАР (картинка / инициалы + ссылка на профиль) ======
  function createAvatarElement(st) {
    let core;
    if (st.avatar) {
      const img = document.createElement("img");
      img.src = st.avatar;
      img.alt = st.name;
      img.className = "avatar";
      core = img;
    } else {
      const div = document.createElement("div");
      div.className = "avatar";
      div.textContent = getInitials(st.name);
      core = div;
    }

    if (st.profile) {
      const link = document.createElement("a");
      link.href = st.profile;
      link.target = "_blank";
      link.rel = "noopener noreferrer";
      link.className = "avatar-link";
      link.appendChild(core);
      return link;
    }

    return core;
  }

  // ====== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ======
  function getInitials(fullName) {
    const parts = fullName.split(/\s+/).filter(Boolean);
    if (parts.length === 0) return "?";
    if (parts.length === 1) return parts[0].slice(0, 2).toUpperCase();
    return (parts[0][0] + parts[1][0]).toUpperCase();
  }

function placeStars(container, completed) {
  container.innerHTML = "";
  if (completed <= 0) return;

  const big = Math.floor(completed / 5); // большие
  const small = completed % 5;           // маленькие

  const bigRadius = 42;
  const smallRadius = 38;
  const bigSize = 20;
  const smallSize = 12;

  const toRad = (deg) => deg * Math.PI / 180;

  // ===== ВЕРХНЯЯ ДУГА (БОЛЬШИЕ ЗВЁЗДЫ) =====
  if (big > 0) {
    const startTop = -160;  // в градусах
    const endTop   = -20;
    const stepTop = (endTop - startTop) / (big + 1);

    for (let i = 0; i < big; i++) {
      const angleDeg = startTop + stepTop * (i + 1);
      const angle = toRad(angleDeg);

      const x = bigRadius * Math.cos(angle);
      const y = bigRadius * Math.sin(angle); // тут всегда ОТРИЦАТЕЛЬНО (сверху)

      const star = document.createElement("span");
      star.className = "star";
      star.textContent = "★";
      star.style.fontSize = bigSize + "px";
      star.style.transform =
        `translate(-50%, -50%) translate(${x}px, ${y}px)`;

      container.appendChild(star);
    }
  }

  // ===== НИЖНЯЯ ДУГА (МАЛЕНЬКИЕ ЗВЁЗДЫ) =====
  if (small > 0) {
    const startBottom = 20;
    const endBottom   = 160;
    const stepBottom = (endBottom - startBottom) / (small + 1);

    for (let i = 0; i < small; i++) {
      const angleDeg = startBottom + stepBottom * (i + 1);
      const angle = toRad(angleDeg);

      const x = smallRadius * Math.cos(angle);
      const y = smallRadius * Math.sin(angle); // тут всегда ПОЛОЖИТЕЛЬНО (снизу)

      const star = document.createElement("span");
      star.className = "star";
      star.textContent = "★";
      star.style.fontSize = smallSize + "px";
      star.style.transform =
        `translate(-50%, -50%) translate(${x}px, ${y}px)`;

      container.appendChild(star);
    }
  }
}




  // ====== ПОИСК ======
  if (searchInput) {
    searchInput.addEventListener("input", (e) => {
      renderAll(e.target.value);
    });
  }

  // Старт
  loadCSV();
</script>
 


</body>
</html>
